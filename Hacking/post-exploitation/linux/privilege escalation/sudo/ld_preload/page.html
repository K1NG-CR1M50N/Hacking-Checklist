<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>LD_PRELOAD</title>
</head><body>If we do sudo -l, we can see the enviroment variable <b>LS_PRELOAD:</b><br/>
<img src="ld_preload.png" /><br/>
<br/>
<br/>
Preloading is a function of the <b>ld </b>command.<br/>
The <b>ld</b>&nbsp;command is available on most Unix systems.<br/>
<b>What we are doing here is we are loading a user shared library, before any other libraries are loaded.<br/>
<br/>
In order to exploit that, we can make our own malicious library!!!<br/>
<br/>
<br/>
To get started, we can create a file called "shell.c"<br/>
</b><img src="ld preload script.png" /><br/>
<br/>
<br/>
We need now to compile this file with PIC (Position Indipentent Code)<br/>
That means the script will work wherever the shell is.<br/>
<br/>
<b>About -shared:<br/>
Produce a shared object which can then be linked with other objects to form an executable.<br/>
Not all systems support this option.<br/>
For predictable results, you must also specify the same set of options<br/>
</b><b>that were used to generate code (-fpic, -fPIC, or model suboptions) when you specify this option.</b><br/>
<br/>
About .so files:<br/>
<a href="https://stackoverflow.com/questions/9809213/what-are-a-and-so-files">https://stackoverflow.com/questions/9809213/what-are-a-and-so-files</a><br/>
<br/>
Archive libraries (.a) are statically linked i.e when you compile your program with -c option in gcc. So, if there's any change in library, you need to compile and build your code again. <br/>
&nbsp;<br/>
The advantage of .so (shared object) over .a library is that they are linked during the runtime i.e. after creation of your .o file -o option in gcc. So, if there's any change in .so file, you don't need to recompile your main program. But make sure that your main program is linked to the new .so file with ln command.<br/>
&nbsp;<br/>
This will help you to build the .so files. <a href="http://www.yolinux.com/TUTORIALS/LibraryArchives-StaticAndDynamic.html">http://www.yolinux.com/TUTORIALS/LibraryArchives-StaticAndDynamic.html</a><br/>
&nbsp;<br/>
Hope this helps.<br/>
&nbsp;<br/>
<br/>
more info about gcc:<br/>
<a href="https://linux.die.net/man/1/gcc">https://linux.die.net/man/1/gcc</a><br/>
<img src="gcc time.png" /><br/>
<br/>
<br/>
Now we can choose the Shared Object (.so) specifing it in the command line:<br/>
(We need to call it from the full path)<br/>
We need to use anything we can use from sudo commands (E.G. apache2, nano, vim etc.)<br/>
<img src="ld exploit 2.png" /></body></html>